{"version":3,"file":"index.modern.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { ComponentType, ReactInstance, Suspense } from 'react';\nimport ReactDom from 'react-dom';\n\nexport function createRoot(id = 'layer-root'): HTMLElement {\n  let root = document.getElementById(id);\n\n  if (root) return root;\n  root = document.createElement('div');\n  root.setAttribute('id', id);\n  document.body.appendChild(root);\n\n  return root;\n}\n\nexport interface LayerType<P = {}> {\n  /**\n   * 子组件实例\n   * @note 只有当子组件为类组件时才有值\n   */\n  instance: ReactInstance | null;\n\n  /**\n   * 挂载组件\n   * @param props 给子组件传递的props\n   */\n  render(props?: Omit<P, 'layer'>): void;\n\n  /**\n   * 销毁组件\n   */\n  destroy(): void;\n  /**\n   * 组件挂载根节点\n   */\n  root: HTMLElement;\n}\n\nexport type LayerComponentProps<P> = {\n  layer?: LayerType<P>;\n} & P;\n\nexport type LC<P> = ComponentType<LayerComponentProps<P>>;\n\nexport function create<P>(\n  Component: LC<P>,\n  root?: HTMLElement | string\n): LayerType<P>;\n\nexport function create<P>(\n  Component: Promise<{ default: LC<P> }>,\n  root?: HTMLElement | string\n): Promise<LayerType<P>>;\n\n/**\n * 创建浮层\n * @param Component 子组件引用\n * @param root 挂载的根节点，默认#layer-root\n */\nexport function create<P>(\n  Component: LC<P> | Promise<{ default: LC<P> }>,\n  root?: HTMLElement | string\n): LayerType<P> | Promise<LayerType<P>> {\n  const layer: LayerType<P> = {\n    instance: null,\n    render() {},\n    root: typeof root === 'string' ? createRoot(root) : root || createRoot(),\n    destroy() {\n      const { root } = layer;\n\n      ReactDom.unmountComponentAtNode(root);\n      layer.instance = null;\n      if (root.parentNode && !root.children.length)\n        root.parentNode.removeChild(root);\n    }\n  };\n\n  function createElement(Comp: any, props: P) {\n    function ref(layerComponent: ReactInstance | null) {\n      if (layerComponent) layer.instance = layerComponent;\n    }\n\n    return Comp.prototype && Comp.prototype.render ? (\n      <Comp ref={ref} layer={layer} {...props} />\n    ) : (\n      <Comp layer={layer} {...props} />\n    );\n  }\n\n  if (Component instanceof Promise) {\n    layer.render = function (props: P) {\n      const LazyComponent = React.lazy<LC<P>>(() => Component);\n      const element = (\n        <Suspense fallback={null}>\n          {createElement(LazyComponent, props)}\n        </Suspense>\n      );\n\n      return ReactDom.render(element, layer.root);\n    };\n\n    return Component.then(() => layer);\n  } else {\n    layer.render = function (props: P) {\n      return ReactDom.render(createElement(Component, props), layer.root);\n    };\n    return layer;\n  }\n}\n"],"names":["createRoot","id","root","document","getElementById","createElement","setAttribute","body","appendChild","create","Component","layer","instance","render","destroy","ReactDom","unmountComponentAtNode","parentNode","children","length","removeChild","Comp","props","ref","layerComponent","prototype","React","Promise","LazyComponent","lazy","element","Suspense","fallback","then"],"mappings":";;;SAGgBA,WAAWC;MAAAA;AAAAA,IAAAA,KAAK;;;AAC9B,MAAIC,IAAI,GAAGC,QAAQ,CAACC,cAAT,CAAwBH,EAAxB,CAAX;AAEA,MAAIC,IAAJ,EAAU,OAAOA,IAAP;AACVA,EAAAA,IAAI,GAAGC,QAAQ,CAACE,aAAT,CAAuB,KAAvB,CAAP;AACAH,EAAAA,IAAI,CAACI,YAAL,CAAkB,IAAlB,EAAwBL,EAAxB;AACAE,EAAAA,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,IAA1B;AAEA,SAAOA,IAAP;AACD;SA8CeO,OACdC,WACAR;AAEA,MAAMS,KAAK,GAAiB;AAC1BC,IAAAA,QAAQ,EAAE,IADgB;AAE1BC,IAAAA,MAF0B,sBAAA;AAG1BX,IAAAA,IAAI,EAAE,OAAOA,IAAP,KAAgB,QAAhB,GAA2BF,UAAU,CAACE,IAAD,CAArC,GAA8CA,IAAI,IAAIF,UAAU,EAH5C;AAI1Bc,IAAAA,OAJ0B;AAKxB,UAAQZ,IAAR,GAAiBS,KAAjB,CAAQT,IAAR;AAEAa,MAAAA,QAAQ,CAACC,sBAAT,CAAgCd,IAAhC;AACAS,MAAAA,KAAK,CAACC,QAAN,GAAiB,IAAjB;AACA,UAAIV,IAAI,CAACe,UAAL,IAAmB,CAACf,IAAI,CAACgB,QAAL,CAAcC,MAAtC,EACEjB,IAAI,CAACe,UAAL,CAAgBG,WAAhB,CAA4BlB,IAA5B;AACH;AAXyB,GAA5B;;AAcA,WAASG,aAAT,CAAuBgB,IAAvB,EAAkCC,KAAlC;AACE,aAASC,GAAT,CAAaC,cAAb;AACE,UAAIA,cAAJ,EAAoBb,KAAK,CAACC,QAAN,GAAiBY,cAAjB;AACrB;;AAED,WAAOH,IAAI,CAACI,SAAL,IAAkBJ,IAAI,CAACI,SAAL,CAAeZ,MAAjC,GACLa,mBAAA,CAACL,IAAD;AAAME,MAAAA,GAAG,EAAEA;AAAKZ,MAAAA,KAAK,EAAEA;OAAWW,MAAlC,CADK,GAGLI,mBAAA,CAACL,IAAD;AAAMV,MAAAA,KAAK,EAAEA;OAAWW,MAAxB,CAHF;AAKD;;AAED,MAAIZ,SAAS,YAAYiB,OAAzB,EAAkC;AAChChB,IAAAA,KAAK,CAACE,MAAN,GAAe,UAAUS,KAAV;AACb,UAAMM,aAAa,GAAGF,KAAK,CAACG,IAAN,CAAkB;AAAA,eAAMnB,SAAN;AAAA,OAAlB,CAAtB;AACA,UAAMoB,OAAO,GACXJ,mBAAA,CAACK,QAAD;AAAUC,QAAAA,QAAQ,EAAE;OAApB,EACG3B,aAAa,CAACuB,aAAD,EAAgBN,KAAhB,CADhB,CADF;AAMA,aAAOP,QAAQ,CAACF,MAAT,CAAgBiB,OAAhB,EAAyBnB,KAAK,CAACT,IAA/B,CAAP;AACD,KATD;;AAWA,WAAOQ,SAAS,CAACuB,IAAV,CAAe;AAAA,aAAMtB,KAAN;AAAA,KAAf,CAAP;AACD,GAbD,MAaO;AACLA,IAAAA,KAAK,CAACE,MAAN,GAAe,UAAUS,KAAV;AACb,aAAOP,QAAQ,CAACF,MAAT,CAAgBR,aAAa,CAACK,SAAD,EAAYY,KAAZ,CAA7B,EAAiDX,KAAK,CAACT,IAAvD,CAAP;AACD,KAFD;;AAGA,WAAOS,KAAP;AACD;AACF;;;;"}